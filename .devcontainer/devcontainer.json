// ./.devcontainer/devcontainer.json
{
  "name": "ai-blueprint-mentor",
  "dockerComposeFile": "./docker-compose.yml",
  "service": "dev",
  "workspaceFolder": "/workspace",
  "features": {},
  "forwardPorts": [3000, 4000],
  "postCreateCommand": "bash -lc 'mkdir -p /workspace/node_modules /workspace/apps/web/.next && sudo chown -R node:node /workspace/node_modules /workspace/apps/web/.next && corepack enable && pnpm -v || true && pnpm i && pnpm db:wait && pnpm migrate:run'",
  "postStartCommand": "bash -lc 'mkdir -p /workspace/node_modules /workspace/apps/web/.next && sudo chown -R node:node /workspace/node_modules /workspace/apps/web/.next || true'",
  "portsAttributes": {
    "3000": { "label": "Next.js (web)", "onAutoForward": "openBrowser" }, //Use "notify"/"ignore" instead of openBrowser
    "4000": { "label": "API (NestJS)", "onAutoForward": "openBrowser" } //Use "notify"/"ignore" instead of openBrowser
  },
  "remoteUser": "node",
  "runServices": ["db"],
  "customizations": {
    "vscode": {
      "settings": {
        // Set Prettier as the default formatter
        "editor.defaultFormatter": "esbenp.prettier-vscode",
        // Enable format on save
        "editor.formatOnSave": true,
        // Optional: Tame the built-in formatters for JS/TS
        // to prevent conflicts with Prettier.
        "[javascript]": {
          "editor.defaultFormatter": "esbenp.prettier-vscode"
        },
        "[typescript]": {
          "editor.defaultFormatter": "esbenp.prettier-vscode"
        },
        "[typescriptreact]": {
          "editor.defaultFormatter": "esbenp.prettier-vscode"
        }
      },
      "extensions": [
        // This ensures the Prettier extension is always installed in the container
        "esbenp.prettier-vscode"
      ]
    }
  },
  "mounts": [
    "source=/var/run/docker.sock,target=/var/run/docker.sock,type=bind"
  ]
}
